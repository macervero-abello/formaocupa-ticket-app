import{b as B,c as d,d as b}from"./chunk-G2EXQAOB.js";import{D as i,E as m,H as f,I as v,a as u,b as p,c as h,f as n,va as g}from"./chunk-7EWN6JVL.js";import{a as _}from"./chunk-4FL3BPNC.js";import{g as o}from"./chunk-2R6CW7ES.js";var E=[{selector:".scanner-container-display",css:"display: block;"},{selector:".scanner-dialog",css:"display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);"},{selector:".scanner-dialog-inner",css:"background-color: #fefefe; margin: 2% auto; padding: 20px; border: 1px solid #888; width: 96%;"},{selector:".close-button",css:"color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;"},{selector:".close-button:hover",css:"color: #222;"},{selector:".scanner-container-full-width",css:"width: 100%;"}];function S(a){let e="custom-style-os-cap-barcode",r=document.getElementById(e);if(r||(r=document.createElement("style"),r.type="text/css",r.id=e,document.head.appendChild(r)),r.sheet){for(;r.sheet.cssRules.length;)r.sheet.deleteRule(0);for(let{selector:t,css:s}of a)r.sheet.insertRule(`${t} { ${s} }`)}else{r.textContent="";for(let{selector:t,css:s}of a)r.textContent+=`${t} { ${s} }`}}var y=_("CapacitorBarcodeScanner",{web:()=>(S(E),import("./chunk-HYCYB2JA.js").then(a=>new a.CapacitorBarcodeScannerWeb))}),l=class{static scanBarcode(e){return o(this,null,function*(){return e.scanInstructions=e.scanInstructions||" ",e.scanButton=e.scanButton||!1,e.scanText=e.scanText||" ",e.cameraDirection=e.cameraDirection||B.BACK,e.scanOrientation=e.scanOrientation||d.ADAPTIVE,y.scanBarcode(e)})}};var P=(()=>{let e=class e{constructor(){this._sessionService=h(g),this._http=h(v),this.LSTAG="FIRAFP_VISITANTS_DATA",this._lastBarcode=n(""),this._readBarcodes=n([]),this._nvisits=n(0),this._sessionError=n(!1),this._serverError=n(!1),this.lastBarcode=i(()=>this._lastBarcode()),this.readBarcodes=i(()=>this._readBarcodes()),this.nvisits=i(()=>this._nvisits()),this.sessionError=i(()=>this._sessionError()),this.serverError=i(()=>this._serverError()),m(()=>{this._sessionService.updateUserData(this._nvisits(),this._readBarcodes())})}loadSavedData(t,s){this._nvisits.set(t),this._readBarcodes.set(s)}scanQR(){return o(this,null,function*(){let t={scanOrientation:d.PORTRAIT,hint:b.QR_CODE,scanButton:!0,scanText:"Escaneja visita!"},s=yield l.scanBarcode(t);s?this._lastBarcode.set(s.ScanResult):this._lastBarcode.set("")})}addVisit(){return o(this,null,function*(){if(this._lastBarcode()=="")return;this._readBarcodes.update(c=>[...c,this._lastBarcode()]),this._nvisits.update(c=>c+1);let t=new f({Authorization:"Bearer "+this._sessionService.user()?.token}),s={ticketnum:this._lastBarcode(),stand_id:this._sessionService.user()?.stand};this._sessionError.set(!1),this._serverError.set(!1);let C=yield u(this._http.post("/api/visit",s,{headers:t})).catch(c=>{this.checkError(c)})})}checkError(t){return o(this,null,function*(){t.status==401||t.stand==404?this._sessionError.set(!0):t.status==500&&this._serverError.set(!0)})}};e.\u0275fac=function(s){return new(s||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let a=e;return a})();export{P as a};
